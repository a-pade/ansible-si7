## YAML Template.
---
- name : Installation Mysql
  hosts: all
  tasks:
      - name : Installer le paquet python-pip
        apt :
          name: python-pip
          state: present
      - name : Installer le module Python pour Mysql
        pip :
         name : PyMySql
         state: present
      - name : Installer le paquet python-mysqldb
        apt :
          name: python-mysqldb
          state: present
      - name : Installer le paquet mysql-server
        apt :
          name: mysql-server
          state: present
      - name: Gestion du my.cnf
        copy:
          src: /root/autres/my.cnf.j2
          dest: /root/.my.cnf
          owner: root
          group: root
          mode: 0600 
      - name : Redémarrer le service mysql
        service:
            name : mysql
            state: restarted
      - name : Gestion du mot de passe du root
        mysql_user:
            name: root
            password: btsinfo
            login_unix_socket: /var/run/mysqld/mysqld.sock
      - name: Création d'une base de données
        mysql_db:
            name: "{{mysql_db}}"
            state: present
            login_unix_socket: /var/run/mysqld/mysqld.sock       
            
      - name: Création de l'utilisateur eleve et affectation des privilèges sur une base de données
        mysql_user:
            name: "{{mysql_user}}"
            password: "{{mysql_password}}"
            host: localhost
            priv: "{{mysql_db}}.*:ALL,GRANT"
            login_unix_socket: /var/run/mysqld/mysqld.sock

- name : PHPMYADMIN Installation
  hosts : all
  tasks:
      - name : Installation module debconf-utils
        apt:
            name : debconf-utils
            state : present
      - name: Installation de dbconfig
        debconf:
            name: phpmyadmin
            question: phpmyadmin/dbconfig-install
            value: true
            vtype: boolean
      - name: Confirmation mdp
        debconf:
            name: phpmyadmin
            question: phpmyadmin/app-password-confirm
            value: mysql_password
            vtype: password
      - name: Mdp Admin
        debconf:
            name: phpmyadmin
            question: phpmyadmin/mysql/admin-pass
            value: mysql_password
            vtype: password
      - name: Mdp utilisateur phpmyadmin
        debconf:
            name: phpmyadmin
            question: phpmyadmin/mysql/app-pass
            value: mysql_password
            vtype: password
      - name: Configuration serveur web
        debconf:
            name: phpmyadmin
            question: phpmyadmin/reconfigure-webserver
            value: apache2
            vtype: multiselect
      - name : Installation phpmyadmin
        apt:
            name: phpmyadmin
            state: present 